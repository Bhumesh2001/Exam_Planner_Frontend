{% extends "base.html" %} {% block title %}Notes — Exam Planner{% endblock %} {%
block content %}

<div class="w-full px-8 py-6">
  <header
    class="flex justify-between items-center mb-8 border-b border-gray-700 pb-4"
  >
    <h2 class="text-3xl font-bold text-white">Notes</h2>
    <div class="flex items-center gap-4">
      <a
        href="{{ url_for('dashboard') }}"
        class="text-gray-300 hover:text-blue-400 transition"
        >Back</a
      >
      <button
        id="openNoteModal"
        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition"
      >
        + Add Note
      </button>
    </div>
  </header>

  <!-- Notes List -->
  <section
    class="bg-gray-900/70 backdrop-blur-md border border-gray-700 rounded-2xl shadow-xl p-8"
  >
    <h3 class="text-2xl font-semibold mb-6 text-white">All Notes</h3>

    {% macro render_node(node) %}
    <div class="ml-4 pl-4 border-l border-gray-700 mb-4">
      <div
        class="bg-gray-800/80 p-4 rounded-lg shadow-sm hover:bg-gray-800 transition"
      >
        <div class="font-semibold text-gray-100">{{ node.title }}</div>
        <div class="text-gray-400 text-sm mt-1">{{ node.content }}</div>
        <form
          action="{{ url_for('delete_note', id=node.id) }}"
          method="post"
          class="mt-3"
        >
          <button
            class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded-lg text-white transition"
          >
            Delete
          </button>
        </form>
      </div>
      {% if node.children %} {% for c in node.children %} {{ render_node(c) }}
      {% endfor %} {% endif %}
    </div>
    {% endmacro %} {% if notes %}
    <div>{% for n in notes %} {{ render_node(n) }} {% endfor %}</div>
    {% else %}
    <p class="text-gray-400">No notes found.</p>
    {% endif %}
  </section>
</div>

<!-- Add Note Modal -->
<div
  id="noteModal"
  class="fixed inset-0 hidden items-center justify-center bg-black/60 z-50"
>
  <div
    class="bg-gray-900 border border-gray-700 rounded-2xl shadow-2xl p-8 w-full max-w-lg relative"
  >
    <button
      id="closeNoteModal"
      class="absolute top-4 right-4 text-gray-400 hover:text-gray-200 text-xl"
    >
      ✕
    </button>
    <h3 class="text-2xl font-semibold mb-6 text-white">Create Note</h3>

    <form method="post" class="space-y-4">
      <div class="grid md:grid-cols-2 gap-4">
        <input
          name="title"
          placeholder="Title"
          class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white"
        />
        <input
          name="parentNote"
          placeholder="Parent Note ID (optional)"
          class="px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white"
        />
      </div>
      <textarea
        name="content"
        rows="4"
        placeholder="Content"
        class="w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white"
      ></textarea>
      <button
        type="submit"
        class="w-full py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition"
      >
        Save Note
      </button>
    </form>
  </div>
</div>

<script>
  const noteModal = document.getElementById("noteModal");
  const openNoteModal = document.getElementById("openNoteModal");
  const closeNoteModal = document.getElementById("closeNoteModal");

  openNoteModal.addEventListener("click", () => {
    noteModal.classList.remove("hidden");
    noteModal.classList.add("flex");
  });

  closeNoteModal.addEventListener("click", () => {
    noteModal.classList.remove("flex");
    noteModal.classList.add("hidden");
  });

  // Close modal on outside click
  noteModal.addEventListener("click", (e) => {
    if (e.target === noteModal) {
      noteModal.classList.remove("flex");
      noteModal.classList.add("hidden");
    }
  });
</script>

{% endblock %}
